<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Timeline</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div id="app">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-sm p-6">
                <h2 class="text-xl font-semibold text-orange-600 mb-6">Test Timeline - Historique</h2>
                
                <div v-if="timelineEvents && timelineEvents.length > 0" class="flow-root">
                    <ul class="-mb-8">
                        <li v-for="(event, index) in timelineEvents" :key="event.id">
                            <div class="relative pb-8">
                                <span v-if="index !== timelineEvents.length - 1" 
                                      class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" 
                                      aria-hidden="true"></span>
                                <div class="relative flex space-x-3">
                                    <div>
                                        <span :class="[
                                          'h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white',
                                          event.type === 'submitted' && 'bg-blue-500',
                                          event.type === 'document_added' && 'bg-green-500',
                                          event.type === 'note_added' && 'bg-yellow-500',
                                          event.type === 'reviewed' && 'bg-purple-500'
                                        ]">
                                            <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path v-if="event.type === 'submitted'" 
                                                      stroke-linecap="round" 
                                                      stroke-linejoin="round" 
                                                      stroke-width="2" 
                                                      d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                                <path v-else-if="event.type === 'document_added'" 
                                                      stroke-linecap="round" 
                                                      stroke-linejoin="round" 
                                                      stroke-width="2" 
                                                      d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                                <path v-else-if="event.type === 'note_added'"
                                                      stroke-linecap="round" 
                                                      stroke-linejoin="round" 
                                                      stroke-width="2" 
                                                      d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                                                <path v-else
                                                      stroke-linecap="round" 
                                                      stroke-linejoin="round" 
                                                      stroke-width="2" 
                                                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </span>
                                    </div>
                                    <div class="min-w-0 flex-1">
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">{{ event.title }}</div>
                                            <p class="mt-0.5 text-sm text-gray-500">{{ formatDate(event.date) }}</p>
                                        </div>
                                        <div v-if="event.description" class="mt-2 text-sm text-gray-700">
                                            {{ event.description }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                
                <div v-else class="text-center py-8">
                    <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <svg class="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h3 class="text-sm font-medium text-gray-900 mb-1">Aucun historique disponible</h3>
                    <p class="text-sm text-gray-500">L'historique de cette candidature n'est pas encore disponible.</p>
                </div>
            </div>

            <div class="mt-6 bg-white rounded-2xl shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">État des données</h3>
                <div class="bg-gray-50 rounded-lg p-4">
                    <pre class="text-sm text-gray-700">{{ JSON.stringify(mockApplication, null, 2) }}</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                // Données d'exemple basées sur l'API réelle
                const mockApplication = ref({
                    id: 20,
                    reference_number: "MA20251008125037",
                    full_name: "John Doe",
                    submitted_at: "2025-10-08T12:50:37.000000Z",
                    reviewed_at: "2025-10-08T14:30:00.000000Z",
                    admin_notes: "Candidature complète et conforme",
                    documents: [
                        {
                            id: 37,
                            type_label: "Pièce d'identité",
                            original_name: "flooz logo.png",
                            size: "39.2 KB",
                            created_at: "2025-10-08T12:50:37.000000Z"
                        },
                        {
                            id: 38,
                            type_label: "Justificatif de domicile",
                            original_name: "facture_eau.pdf",
                            size: "245 KB",
                            created_at: "2025-10-08T12:52:15.000000Z"
                        }
                    ]
                });

                // Timeline calculée à partir des données disponibles
                const timelineEvents = computed(() => {
                    if (!mockApplication.value) return []
                    
                    const events = []
                    
                    // Événement de soumission
                    if (mockApplication.value.submitted_at) {
                        events.push({
                            id: 'submitted',
                            type: 'submitted',
                            title: 'Candidature soumise',
                            description: `Candidature #${mockApplication.value.reference_number} soumise par ${mockApplication.value.full_name}`,
                            date: mockApplication.value.submitted_at
                        })
                    }
                    
                    // Événements des documents
                    if (mockApplication.value.documents && mockApplication.value.documents.length > 0) {
                        mockApplication.value.documents.forEach((doc, index) => {
                            events.push({
                                id: `document-${doc.id}`,
                                type: 'document_added',
                                title: `Document ajouté : ${doc.type_label}`,
                                description: `${doc.original_name} (${doc.size || 'Taille inconnue'})`,
                                date: doc.created_at
                            })
                        })
                    }
                    
                    // Événement de révision (si disponible)
                    if (mockApplication.value.reviewed_at && mockApplication.value.admin_notes) {
                        events.push({
                            id: 'reviewed',
                            type: 'note_added',
                            title: 'Note administrative ajoutée',
                            description: 'Une note administrative a été ajoutée par l\'équipe de révision',
                            date: mockApplication.value.reviewed_at
                        })
                    }
                    
                    // Trier les événements par date (plus récent en premier)
                    return events.sort((a, b) => new Date(b.date) - new Date(a.date))
                })

                const formatDate = (dateString, dateOnly = false) => {
                    if (!dateString) return '';
                    const options = {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        ...(dateOnly ? {} : { hour: 'numeric', minute: 'numeric' })
                    }
                    return new Date(dateString).toLocaleDateString('fr-FR', options)
                }

                return {
                    mockApplication,
                    timelineEvents,
                    formatDate
                }
            }
        }).mount('#app');
    </script>
</body>
</html>