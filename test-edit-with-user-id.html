<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Edition avec user_id</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .commercial-info { background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .disabled-note { background: #dbeafe; padding: 10px; border-radius: 6px; margin: 10px 0; color: #1e40af; }
        input:disabled { background-color: #e5e7eb; color: #6b7280; cursor: not-allowed; }
        input { padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; margin: 5px 0; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        .container { max-width: 600px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test - Édition de candidature avec user_id</h1>
        
        <div>
            <h3>Tests avec user_id (champs désactivés) :</h3>
            <button onclick="loadApplication(20)">Candidature ID 20 (user_id: 2)</button>
            <button onclick="loadApplication(1)" style="margin-left: 10px;">Candidature ID 1 (user_id: 2)</button>
            <button onclick="loadApplication(15)" style="margin-left: 10px;">Candidature ID 15 (user_id: 2)</button>
            
            <h3 style="margin-top: 20px;">Tests sans user_id (champs modifiables) :</h3>
            <button onclick="loadApplication(4)">Candidature ID 4 (user_id: null)</button>
            <button onclick="loadApplication(5)" style="margin-left: 10px;">Candidature ID 5 (user_id: null)</button>
            <button onclick="loadApplication(6)" style="margin-left: 10px;">Candidature ID 6 (user_id: null)</button>
        </div>

        <div id="application-info" style="margin: 20px 0;"></div>

        <div class="commercial-info">
            <h3>Informations du Commercial</h3>
            
            <div id="disabled-note" class="disabled-note" style="display: none;">
                <strong>Information :</strong> Ces informations ne peuvent pas être modifiées car cette candidature est liée à un utilisateur commercial spécifique.
            </div>

            <label for="commercialLastName">Nom du commercial :</label>
            <input type="text" id="commercialLastName" placeholder="Nom">

            <label for="commercialFirstName">Prénoms du commercial :</label>
            <input type="text" id="commercialFirstName" placeholder="Prénoms">

            <label for="commercialPhone">Téléphone du commercial :</label>
            <input type="text" id="commercialPhone" placeholder="Téléphone">
        </div>

        <div id="debug-info" style="margin-top: 20px; padding: 10px; background: #fef3c7; border-radius: 6px;">
            <h4>Informations de debug</h4>
            <div id="debug-content"></div>
        </div>
    </div>

    <script>
        let currentApplicationUserId = null;

        function isCommercialInfoDisabled() {
            return currentApplicationUserId !== null;
        }

        function updateCommercialFields() {
            const isDisabled = isCommercialInfoDisabled();
            const note = document.getElementById('disabled-note');
            
            // Afficher/masquer la note d'information
            note.style.display = isDisabled ? 'block' : 'none';
            
            // Activer/désactiver les champs
            document.getElementById('commercialLastName').disabled = isDisabled;
            document.getElementById('commercialFirstName').disabled = isDisabled;
            document.getElementById('commercialPhone').disabled = isDisabled;
            
            // Mettre à jour les titres
            const title = isDisabled ? 'Non modifiable - Candidature liée à un utilisateur' : '';
            document.getElementById('commercialLastName').title = title;
            document.getElementById('commercialFirstName').title = title;
            document.getElementById('commercialPhone').title = title;
        }

        async function loadApplication(applicationId) {
            try {
                document.getElementById('application-info').innerHTML = '<p>Chargement en cours...</p>';
                document.getElementById('debug-content').innerHTML = '';

                const response = await axios.get(`http://localhost:8000/api/merchant-applications/${applicationId}`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                const data = response.data.data;
                
                // Mettre à jour les informations d'application
                document.getElementById('application-info').innerHTML = `
                    <h3>Candidature ${data.reference_number}</h3>
                    <p><strong>Nom :</strong> ${data.first_name} ${data.last_name}</p>
                    <p><strong>Email :</strong> ${data.email || 'N/A'}</p>
                    <p><strong>User ID :</strong> ${data.user_id || 'Aucun'}</p>
                    <p><strong>Statut :</strong> ${data.status_label}</p>
                `;

                // Stocker le user_id
                currentApplicationUserId = data.user_id;
                
                // Pré-remplir les champs commerciaux
                if (data.commercial) {
                    document.getElementById('commercialLastName').value = data.commercial.last_name || '';
                    document.getElementById('commercialFirstName').value = data.commercial.first_name || '';
                    document.getElementById('commercialPhone').value = data.commercial.phone || '';
                }

                // Mettre à jour l'état des champs
                updateCommercialFields();

                // Afficher les informations de debug
                document.getElementById('debug-content').innerHTML = `
                    <p><strong>Application ID :</strong> ${applicationId}</p>
                    <p><strong>User ID :</strong> ${currentApplicationUserId || 'null'}</p>
                    <p><strong>Champs désactivés :</strong> ${isCommercialInfoDisabled() ? 'Oui' : 'Non'}</p>
                    <p><strong>Données commerciales :</strong> ${JSON.stringify(data.commercial, null, 2)}</p>
                `;

            } catch (error) {
                console.error('Erreur lors du chargement:', error);
                document.getElementById('application-info').innerHTML = `
                    <p style="color: red;">Erreur lors du chargement de la candidature ${applicationId}: ${error.message}</p>
                `;
                document.getElementById('debug-content').innerHTML = `
                    <p style="color: red;">Erreur: ${JSON.stringify(error.response?.data || error.message, null, 2)}</p>
                `;
            }
        }

        // Test initial
        document.addEventListener('DOMContentLoaded', function() {
            updateCommercialFields();
        });
    </script>
</body>
</html>